---
title: Notes《系统架构设计师-希赛》（一）计算机组成与体系结构
date: 2018-01-01 18:02:34
tags:
- Notes
- 架构
category:
- Notes
- 《系统架构设计师》（希赛）
mathjax: true
---

# 第一章 计算机组成与体系结构
## 1.1 计算机系统组成
计算机系统是一个硬件和软件的综合体。
### 1.1.1 计算机硬件的组成
以运算器为中心 -> 以存储器为中心
1. 控制器：分析和执行指令
	* 程序计数器PC：存储下一条执行指令的地址
	* 指令寄存器IR：存储即将执行的指令
	* 指令译码器ID：对指令中的操作码字段进行分析解释
	* 时序部件：提供时序控制信号
2. 运算器：
	* 算术逻辑单元ALU：数据的算术运算和逻辑运算
	* 累加寄存器AC：通用寄存器，为ALU提供一个工作区暂存数据
	* 数据缓冲寄存器DR：写内存时，暂存指令或数据
	* 状态条件寄存器PSW：存状态标志和控制标志
3. 主存储器（内存）：存储现场操作的信息与中间结果
4. 辅助存储器（外存）
5. 输入设备
6. 输出设备

<!-- more -->

### 1.1.2 计算机系统结构的分类
电子管 -> 晶体管 -> 集成电路时代
**存储程序**：计算机应由运算器、存储器、控制器、输入设备和输出设备五大部件组成、内部采用二进制来表示指令和数据；将编号的程序和袁术数据实现存入存储器中，然后启动计算机工作。
Flynn按**指令流**（机器执行的指令序列）和**数据流**（有指令流调用的数据序列，包括输入数据和中间结果，但不包括输出）进行分类：
* 单指令流单数据流SISD：单处理器计算机
* 单指令流多数据流SIMD：矩阵处理器
* 多指令流单数据流MISD：很少见
* 多指令流多数据流MIMD：多核处理器，多处理器

### 1.1.3 复杂指令集系统和精简指令集系统
||复杂指令集系统CISC|精简指令集系统RISC|
|:---|:---|:---|
|指令数量|多，100-250种|少，只有两条指令用户存储器，其余都在CPU的寄存器之间进行|
|寻址方式|多，5-20种|通常只支持寄存器寻址方式，立即数寻址方式和相对寻址方式|
|指令长度|变长、增加指令译码电路的复杂性|固定，格式少，相对简单，译码容易|
|直接处理主存数据|可以，执行慢|无，只有LOAD和STORE两条指令存取数据|
|控制方式|微程序|硬布线逻辑（组合逻辑）|
|其他|指令使用频率差异大|几乎单周期执行、编译器易于优化、通用寄存器数量多，使用Cache方案|

### 1.1.4 总线
总线是一组能为多个部件分时共享的公共信息传送线路。
* 共享：总线上可以挂接多个部件；
* 分时：同一时刻只允许一个部向总线发送信息，可以多个部件接收相同的信息；
按位置分类：
* 内部总线：寄存器、ALU、控制部件之间
* CPU和存储、输入、输出设备
按功能分类：地址总线、数据总线、控制总线

## 1.2 存储器系统
程序局部性：
* 时间局部性：某条指令一旦执行，不久后可能再次执行。
* 空间局部性：一旦程序访问了某个存储单元，不久后其附近的存储单元也将被访问。
存储器中数据常用的存取方式：
* 顺序存取：线性顺序，磁带存储器
* 直接存取：使用一个共享的读写装置对数据块进行寻址访问，，磁盘存储器
* 随机存取：每一个可寻址单元都具有自己唯一的地址和读写装置，主存
* 相联存取：也是一种随机存取形式，但读写选择取决于内容而不是地址，Cache

### 1.2.1 主存储器
||动态RAM|静态RAM|ROM|
|---|---|---|---|
|存取|读写|读写|只读|
|持久性|随时间逐渐消失，断电消失|一直保持，断电消失|不消失|
|速度|较快|快|慢|

### 1.2.2 辅助存储器
1. 磁带存储器：存取时间长、容量大、便于携带、便宜、用于归档保存；
2. 磁盘存储器：
* 记录面和磁头一一对应；
* 所有磁头移动一致；
* 每个记录面含多个磁道，最外圈是磁道0，最内圈是磁道n；
* 每个记录面有多个扇区，由操作系统决定，编号从1开始；
* 所有记录面的同一磁道构成一个圆柱面；
* **文件存储位置顺序**：扇区 -> 同磁道扇区 -> 同柱面磁道 -> 相邻柱面
* 磁盘访问时间（存取时间） = 寻道时间+旋转延迟时间

### 1.2.3 Cache存储器
Cache的功能是提高CPU数据输入输出的速率，容量小但速度快。
Cache通常采用相联存储器CAM ContentAddressable Memory。基于数据内容访问，速度比基于地址要快很多。
#### Cache的基本原理
程序的局限性原理。cache中能找到直接返回，不能找到则从内存中读取，同时返回CPU和Cache。
平均存取周期t3 = cache周期t1 * cache访问命中率h + 内存周期t2 * （1-h）
#### 映射机制
1. 直接映像
* 主存地址被分成三个部分：区号、页号、页内地址（数据部分）
* 内存容量按Cache容量分区，一个区的大小就是Cache容量的大小
* 每个区按页面大小再分页，Cache也分页
* **每个区的n号页，只能固定存入Cache对应的n号页中**，缺点是不灵活，Cache空间不能得到充分利用

2. 全相联映像
* 主存地址被分成两个部分：页号（地址部分）、页内地址（数据部分）
* **主存的每一页可以映射到Cache的任一页中**，需要将主存页标记与Cache各页标记逐个比较。成本太高，只适用于小容量Cache

3. 组相联映像
* 主存地址被分成四个部分：区号、组号、组内页号、页内地址
* 每个区和Cache先分组再分页
* 折中方案，组之间按直接映像，组内页按全相联映像。**每个组对应固定存入Cache相同的组，但组内的页可以任意映射**

#### 替换算法
淘汰Cache中的旧数据，存入新数据
1. 随机算法：随机选一个Cache块替换
2. 先进先出FIFO：记录时间，最老的Cache块被替换
3. 近期使用最少LRU：记录使用情况，最不常使用的Cache块被替换

#### 写操作
保持Cache和内存的数据同步
1. 写直达 write through：当要写Cache是，数据同时写会内存。降低存取速度
2. 写回 write back：修改Cache后，不立即写内存，并设修改标志位。只有Cache要淘汰时，标志位为1的被写入内存
3. 标记法：设有效标记位，当修改Cache时，标记位置0，并写回内存。读Cache时，若标记位为0，则从内存读取

## 1.3 流水线
流水线技术吧一个任务分解为若干顺序执行的子任务，并行执行，提高效率。
### 1.3.1 流水线周期
最耗时的那一段任务消耗的时间
### 1.3.2 计算流水线执行时间
**理论时间** = {% raw %}第一条指令每个阶段执行的总时间+（n-1）*流水线周期{% endraw %}
**实际时间** = {% raw %}流水线周期*阶段数 + （n-1）*流水线周期{% endraw %}
每个阶段消耗的时间统一为流水线周期

### 1.3.3 流水线的吞吐率
$TP=\frac{n}{T_k}$

{% math %}TP_{max}=\lim_{n\to\infty}\frac{n}{(k+n-1)\Delta t}=\frac{1}{\Delta t}{% endmath %}

$\Delta t$是流水线周期

### 1.3.4 流水线的加速比
$S = \frac{不使用流水线顺序执行的时间T_O}{使用流水线的执行时间T_k}$

$S=\frac{nk\Delta t}{(k+n-1)\Delta t}=\frac{nk}{k+n-1}$

{% math %}S_{max}=\lim_{n\to\infty}\frac{nk}{k+n-1}=k{% endmath %}










